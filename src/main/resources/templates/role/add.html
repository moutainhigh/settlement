<!DOCTYPE html>
<html class="x-admin-sm" xmlns:th="http://www.thymeleaf.org">

<head>
    <th:bolck th:include="common/header :: header('添加角色')" />
</head>
  
  <body>
    <div class="layui-fluid">
        <div class="layui-row">
            <form action="" method="post" class="layui-form layui-form-pane">
                <input type="hidden" name="id" th:value="${sysRole.id}" th:if="${mode.equals('update')}" />
                <div class="layui-form-item">

                    <div class="layui-inline">
                        <label  for="roleCnName" class="layui-form-label">
                            <span class="x-red">*</span>角色中文名
                        </label>
                        <div class="layui-input-inline">
                            <input type="text" id="roleCnName" name="roleCnName" th:value="${sysRole!=null}?${sysRole.roleCnName}" required="" lay-verify="roleCnName"
                            autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label for="roleEnName" class="layui-form-label">
                            <span class="x-red">*</span>角色英文名
                        </label>
                        <div class="layui-input-inline">
                            <input type="text" id="roleEnName" name="roleEnName" th:value="${sysRole!=null}?${sysRole.roleEnName}" required="" lay-verify="roleEnName"
                               autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">

                    <div class="layui-inline">
                        <label  for="roleCode" class="layui-form-label">
                            <span class="x-red">*</span>角色编码
                        </label>
                        <div class="layui-input-inline">
                            <input type="text" id="roleCode" name="roleCode" th:readonly="${sysRole!=null}?true" th:value="${sysRole!=null}?${sysRole.roleCode}"required="" lay-verify="roleCode"
                                   lay-filter="roleCode" autocomplete="off" class="layui-input">
                        </div>
                        <div class="layui-input-inline">
                            <button type="button" id="roleCodeIsExist" th:if="${sysRole==null}" lay-filter="roleCodeIsExist" class="layui-btn layui-btn-primary layui-btn-xs">检查角色编码是否可用</button>
                        </div>
                    </div>

                </div>
                <div class="layui-form-item">
                    <label for="remark" class="layui-form-label">
                        <span class="x-red">*</span>角色备注
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="remark" name="remark" th:value="${sysRole!=null}?${sysRole.remark}" required="" lay-verify="remark"
                               autocomplete="off" class="layui-input">
                    </div>
                </div>
<!--                -->
<!--                <div class="layui-form-item layui-form-text">-->
<!--                    <label class="layui-form-label">-->
<!--                        拥有权限-->
<!--                    </label>-->
<!--                    <table  class="layui-table layui-input-block">-->
<!--                        <tbody>-->
<!--                        <div th:each="mroot:${maproot}">-->
<!--                            <div th:each="listchild,stats:${mroot.getValue()}">-->
<!--                                <tr>-->
<!--                                    <div th:each="m:${listchild.entrySet()}">-->
<!--                                        <td th:rowspan="${stats.size}" th:if="${stats.first}" width="20%">-->
<!--&lt;!&ndash;                                        <td width="20%">&ndash;&gt;-->
<!--                                            <input type="checkbox" name="sysPermissions[]" lay-skin="primary" lay-filter="father" th:checked="${sysRole!=null}?${mroot.getKey().isChecked()}" th:value="${mroot.getKey().getId()}" th:title="${mroot.getKey().getPName()}">-->
<!--                                        </td>-->

<!--                                        <td width="20%">-->
<!--                                            <input type="checkbox" name="sysPermissions[]" lay-skin="primary" lay-filter="father"  th:checked="${sysRole!=null}?${m.getKey().isChecked()}" th:value="${m.getKey().getId()}" th:title="${m.getKey().getPName()}">-->
<!--                                        </td>-->

<!--                                        <td width="60%">-->
<!--                                            <input type="checkbox" name="sysPermissions[]" lay-skin="primary" lay-filter="father" th:each="sys:${m.getValue()}" th:checked="${sysRole!=null}?${sys.isChecked()}" th:value="${sys.getId()}" th:title="${sys.getPName()}" value="2">-->
<!--                                        </td>-->
<!--                                    </div>-->
<!--                                </tr>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        </tbody>-->
<!--                    </table>-->
<!--                    <table  class="layui-table layui-input-block">-->
<!--                        <tbody>-->
<!--                        <tr>-->
<!--                            <td>-->
<!--                                <input type="checkbox" name="like1[write]" lay-skin="primary" lay-filter="father" title="用户管理">-->
<!--                            </td>-->
<!--                            <td>-->
<!--                                <div class="layui-input-block">-->
<!--                                    <input name="id[]" lay-skin="primary" type="checkbox" title="用户停用" value="2">-->
<!--                                    <input name="id[]" lay-skin="primary" type="checkbox" value="2" title="用户删除">-->
<!--                                    <input name="id[]" lay-skin="primary" type="checkbox" value="2" title="用户修改">-->
<!--                                    <input name="id[]" lay-skin="primary" type="checkbox" value="2" title="用户改密">-->
<!--                                    <input name="id[]" lay-skin="primary" type="checkbox" value="2" title="用户列表">-->
<!--                                    <input name="id[]" lay-skin="primary" type="checkbox" value="2" title="用户改密">-->
<!--                                    <input name="id[]" lay-skin="primary" type="checkbox" value="2" title="用户列表">-->
<!--                                    <input name="id[]" lay-skin="primary" type="checkbox" value="2" title="用户改密">-->
<!--                                    <input name="id[]" lay-skin="primary" type="checkbox" value="2" title="用户列表">-->
<!--                                </div>-->
<!--                            </td>-->
<!--                        </tr>-->
<!--                        <tr>-->
<!--                            <td>-->

<!--                                <input name="id[]" lay-skin="primary" type="checkbox" value="2" title="文章管理" lay-filter="father">-->
<!--                            </td>-->
<!--                            <td>-->
<!--                                <div class="layui-input-block">-->
<!--                                    <input name="id[]" lay-skin="primary" type="checkbox" value="2" title="文章添加">-->
<!--                                    <input name="id[]" lay-skin="primary" type="checkbox" value="2" title="文章删除">-->
<!--                                    <input name="id[]" lay-skin="primary" type="checkbox" value="2" title="文章修改">-->
<!--                                    <input name="id[]" lay-skin="primary" type="checkbox" value="2" title="文章改密">-->
<!--                                    <input name="id[]" lay-skin="primary" type="checkbox" value="2" title="文章列表">-->
<!--                                </div>-->
<!--                            </td>-->
<!--                        </tr>-->
<!--                        </tbody>-->
<!--                    </table>-->
<!--                </div>-->
                <div class="layui-form-item">
                <button class="layui-btn" th:text="${mode.equals('add')}?'增加' : '修改'" lay-submit="" lay-filter="add">增加</button>
              </div>
            </form>
        </div>
    </div>
    <script th:src="@{/js/role/role.js}" type="text/javascript" charset="utf-8"></script>
    <script th:inline="javascript">
        layui.use(['form','layer'], function(){
            $ = layui.jquery;
          var form = layui.form
          ,layer = layui.layer;
            form.render();
          //自定义验证规则
          form.verify({
              roleCnName: function(value){
                  if(value.trim().length < 1){
                    return '角色中文名至少得1个字符啊';
                  }
                },
              roleEnName: function(value){
                  if(value.trim().length < 1){
                      return '角色英文名至少得1个字符啊';
                  }
              },
              roleCode: function(value){
                  if(value.trim().length < 1){
                      return '角色编码至少得1个字符啊';
                  }
              },
              remark: function(value){
                  if(value.trim().length < 1){
                      return '角色备注至少得1个字符啊';
                  }
              }
          });

        $("#roleCodeIsExist").click(function(){
            var roleCode=$('#roleCode').val();
            if(roleCode.trim().length==0) {
                layer.msg('角色编码不能为空',{icon:5});
                return false;
            }
           //异步加载判断是否唯一
            checkRoleCodeIsExist(roleCode,layer,'');

        });
          //监听提交
          form.on('submit(add)', function(data){
              var mode=[[${mode}]];

            //发异步，把数据提
              if("add" == mode && checkRoleCodeIsExist($('#roleCode').val(),layer,'submit')) {
                  $.post('/sys-role/add',data.field,function(r){
                      layer.alert(r.msg, {
                              icon : r.code == 'add_200' ? 6: 5
                          },
                          function() {
                              //关闭当前frame
                              xadmin.close();
                              // 可以对父窗口进行刷新
                              xadmin.father_reload();
                          });
                  });
              } else if("update" == mode) {
                  $.post('/sys-role/update',data.field,function(r){
                      layer.alert(r.msg, {
                              icon : r.code == 'edit_200' ? 6: 5
                          },
                          function() {
                              //关闭当前frame
                              xadmin.close();
                              // 可以对父窗口进行刷新
                              xadmin.father_reload();
                          });
                  });
              }

            return false;
          });
        });
    </script>
  </body>

</html>